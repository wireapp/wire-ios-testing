machine:
  xcode:
    version: "8.3"
  environment:
    DEPENDENCIES_BASE_URL: "https://raw.githubusercontent.com/wireapp/wire-ios-shared-resources/feature/ci-improvements"
    DANGER_GITHUB_API_TOKEN: $GITHUB_ACCESS_TOKEN
checkout:
  post:
    # Download other scripts
    - curl -O "${DEPENDENCIES_BASE_URL}/.circlerc"
    - curl -O "${DEPENDENCIES_BASE_URL}/dependencies.sh"
    - curl -O "${DEPENDENCIES_BASE_URL}/build.sh"
    - curl -O "${DEPENDENCIES_BASE_URL}/test.sh"
    - curl -O "${DEPENDENCIES_BASE_URL}/post_test.sh"

dependencies:
  override:
    - sh dependencies.sh
  cache_directories:
    - Carthage/Build
    - ~/.gem

test:
  override:
    - sh build.sh
    - sh test.sh
    - sh post_test.sh
  post:
    - mkdir "${CIRCLE_ARTIFACTS}/scripts"
    - cp *.sh "${CIRCLE_ARTIFACTS}/scripts"
    - cp .circlerc "${CIRCLE_ARTIFACTS}/scripts"
